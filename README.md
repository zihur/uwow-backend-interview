## 實作測驗

該專案方便啟用，請理解將 .env.example 包含了部分機敏資訊

### 前置需求
- Docker 與 Docker Compose（或 Docker Desktop）
> 如果是 windows 建議請安裝 wsl2，並在 wsl2 內部`非 /mnt/c/...` 相關位置進行專案開發

### 如何開始（開發環境）
1. **類 Unix 環境**

    專案已提供 `init.sh` 腳本，clone 下來之後，第一次可在本機直接執行一鍵完成常用部署步驟（啟動容器、安裝相依、產生 key、執行 migrate、產生 API 文件、啟動 queue worker）：

    ```bash
    chmod +x init.sh
    sh ./init.sh
    ```

2. **Windows 環境**

    專案已提供 `init.bat` 腳本，clone 下來之後，CMD 使用者，第一次可在本機直接執行一鍵完成常用部署步驟（啟動容器、安裝相依、產生 key、執行 migrate、產生 API 文件、啟動 queue worker）：

> 注意：兩者均會自動啟動容器並執行初始化步驟，**會自動啟動 queue worker**，若是想觀察 worker log 可參考下方輔助指令。

3. 查看 `http://localhost:8000/api` 是否正常運作，你應該可以看到 `"message": "API is working"`

---

### 其他輔助指令
- 產生 scribe 文檔：

    ```bash
    docker compose exec app php artisan scribe:generate --force
    ```
> 使用 --force 避免 .scribe 的 cache，也可省略


- docker 銷毀重置指令（!!警告，這會將所有連同 images 都砍掉，請確定知道自己在做什麼）：
    ```bash
    docker compose down --rmi all -v
    ```

- **Scribe 文檔位置** http://localhost:8000/docs/ 
---

# 簡答題題目文檔相關
## Q1. 請解釋題目中的圖片以及重新設計
已重新設計觀點來看，我覺得左上角的 Score 應該更明確放大突出一些，並且背景如果要用顏色突出分數，這邊不應該使用漸變顏色，可以直接是不同分數不同顏色，去強調商品的分數高低，商品名稱的比例我覺得可以更大一些，至少要比商品照下方的分數還要大，甚至可以考慮移除商品照下方分數，因為左上角已經有綜合評分了，相對的商品敘述可以少一些，如果不夠放可以使用...去暗示使用者有更多細節，可以點進產品觀看

價格部分，我覺得放在目前位置是可以的，即使有特價前後的呈現設計，應該也相對好做變化，另外若有收藏功能，也可以輕易加入


## Q2. 請說明如果嘗試手刻一個框架，會怎麼做？

以手搓框架上來想，我應該會優先著重思考流程架構面，因為框架某部分來說就是規範了整個開發的共同流程，期望讓大家對於開發流程上有接近的觀點，但又可以保有靈活性，所以拆成各種階段，我認為會比較適合

目前框架很多都會設計單一入口點，在 Router 做分流上的轉換，以後端來說 route > middleware (預處理資料) > controller (主要負責控制流程用，期望讓人能在這邊就能明白 api 在做什麼事情) > service(這邊指的是廣義的 service 主要的商業處理，例如 laravel 的 request 也是一種 service...等等) > model(和數據庫的資料處理) > 回傳資料則是逆推回去，但會過一層 presenter (也算是一種 service)，大致上整個流程會先這樣界定。

前端其實也會很類似，統一入口 router 進入到各檔案，處理畫面檔案，同時數據和畫面會是分開的處理邏輯我會廣義上概括為不同的 service，前端的資料也會需要一個類似 model 層的腳色處理，因為要去跟 api 拿資料等等，總體來說是類似的

以更深層的功能來看，檔案自動載入機制，套件管理，錯誤與異常處理也會是可以加入的服務，是我認為都是非常重要的一部份，另外支援環境設定檔案的切分，也相當重要，至於 laravel 依賴注入容器概念，我想這也是一種很好用的設計模式，只是每個語言特性等等，都會有所不同，因此我目前不太確定是否所有語言都適用

## Q3. 客戶會給一份非常巨量的 html 資料檔案要處理搜尋，排序，分頁，會如何轉成方便客戶開啟使用的程式？請提供純前端解決方案以及純後端解決方案
- 前端：
針對純前端處理非常巨量資料問題，我目前並沒有實際預到這個場景過，但我想到的可能問題點會有以下幾個，資料載入問題，這邊我會嘗試將 html 資料進行序列化改成二進制之類的文件檔案，接著進行分批載入，載入資料後，就是要呈現資料了，根據題目的巨量資料內容不應該同時呈現資料，會需要處理分頁，這邊我目前想到的會是處理一份獨立的檔案 meta 紀錄分頁檔案問題，因為分頁了，單一畫面的資料量呈現可以降低到一定程度，減少渲染上的問題，應該會好很多，若還不足，可能就會需要借助到 TanStack 這類第三方專用套件了。搜尋問題，巨量的資料運算可能會導致前端畫面運作 js 時卡死，因此根據我的理解，這邊應該可以用到 web worker 去進行處理，並且可以將資料放在瀏覽器的 indexDB 內，類似於一個資料庫了。而排序問題，我會選擇用中值插入計算的演算法去設定資料的排序位置，這樣可以避免每次都重新計算

- 後端：
純後端方案這邊我的理解猜測重點應該是資料處理方式，另外就是讓客戶能方便啟用的單體應用程式，所以我會選擇研究使用 FrankenPHP 或著 ZZEE PHPExe，而資料處理的部分就是一樣需要先將客戶給的巨量 html 資料先進行結構化以及序列化處理。因為客戶應該不會有所謂的 mysql 這類 DB，因此我們可以使用 Sqlite，本質上這只是一個檔案，但會方便許多，甚至可以使用索引去處理相關資料了，若是能允許連線，甚至我們可以將資料整理放入 eastic search

## Q4. 請根據題目設計使用者介面給後台管理人員使用，並且解釋設計？
- Dashboard for Website Owner to see
  關於 Dashboard ，因為主要是進入後台看到的第一個畫面，我會設計幾個主要的功能進行呈現
  - 網站狀態
  - 站上人數
  - 近日會員成長人數
  - 每日發文數量趨勢圖
  - 近日熱門文章(依照觀看數)
  - 文字雲，或著可以用關鍵字排行
  - 被大量加入會員最愛的文章(可篩選日月年等時段)
  - 自定義常用功能區塊(快速發文，進入常用功能等等)。
  
  這些功能都是基於數據上的快速呈現，讓管理人員可以快速知道網站狀態，其中被大量加入 folder 的文章，這部分很可能和熱門文章重疊，因此我的設計上會希望是以 (被加入會員最愛的數量 / 一定瀏覽數以上) 的演算法去呈現，這樣可以幫助管理者發現一些或許尚未被大量發現，但是受喜愛程度很高的潛力文章，因此畫面上這邊應該要可以快速連去推廣功能頁面

  除了這些之外可以在適當的功能右上角可以放入 tips 功能，說明相關資訊

- User Management
  這邊可以區分為會員列表，以及會員詳細相關資料，列表部份我會在設計搜尋功能(會員ID，名稱)，方便管理員進行管理尋找，詳細相關資料部分，就是可以查詢會員資料，也可以列出會員所寫過的文章，文章瀏覽人數，文章快速連結等等之類的

- User Favorites Management 
  這邊一樣會有最多人喜愛的列表，同時需要加上時段篩選，因為最多人喜歡通常會長期霸榜，失去觀測意義，另外我會考慮放上一些功能是針對這些文章做推廣等等之類的


## Q5. 這兩張表透過 inner join，right join 合併的各自結果是什麼？
Database Table User
| UserID | Name | Age |
| :---: | :----: | :---: |
| 1 |Prescott |Bartlett |27|
| 2 |Gavin |Cortez |22|
| 3 |Lael |Greet |30|

Database Table Product Purchased 
|UserID |BrandName |ProductName |Price |Buy Time| 
| :---: | :----: | :---: | :---: | :---: |
|1 |Gap |Sweater |35.99 |2010/10/02| 
|3 |Nike |Shoes |125.99 |2013/06/12|
|4 |Adidas |Shoes |105.99 |2013/08/25|
|5 |H&M |Jacket |129.99 |2013/05/09|

### Inner Join 結果
|UserID |Name |BrandName |ProductName |Price |Buy Time|
| :---: | :----: | :---: | :---: | :---: | :---: |
|1 |Prescott Bartlett |Gap |Sweater |35.99 |2010/10/02|
3 |Lael Greet |Nike |Shoes |125.99 |2013/06/12|

### Right Join 結果
|UserID |Name |BrandName |ProductName |Price |Buy Time|
| :---: | :----: | :---: | :---: | :---: | :---: |
|1 |Prescott Bartlett |Gap |Sweater |35.99 |2010/10/02|
|3 |Lael Greet |Nike |Shoes |125.99 |2013/06/12|
|4 |*NULL* |Adidas |Shoes |105.99 |2013/08/25|
|5 |*NULL* |H&M |Jacket |129.99 |2013/05/09|

## Q6. 會怎麼透過索引設計，提升題目的 SELECT 速度？
依照題目 sql 內容撰寫符合 最左匹配原則 的複合索引，這邊會選擇
publisher_id, domain_id, date, landing_page

## Q7. 會如何設計支援 50000 併發連線的架構？
最外層用 CDN 作為靜態資料流量的處理，接著可以透過 HAProxy 作為負載平衡(loadbalancer)去處理分流到不同的節點伺服器，根據不同情境，後端 PHP 會採用 Swoole 常駐模式，省去每次請求都重啟框架的開銷，同時異步特性處理 I/O 密集任務時避免阻塞，靜態資源的的讀取會獨立掛載於外部 例如 s3

API 及時處理資料的部分會透過 Redis Cluster 處理高頻讀取請求，同時會運用消息佇列(kafka/RabbitMQ)，針對耗時任務做特別處理進行寫入請求，讓其他後端機器去消化資料，避免突發性湧入造成資料庫以及應用程式上的負擔

資料庫部分也會做讀寫分離，如果資料量極大，資料庫也要做分庫分表機制

在自我預防死機上也需要有 RateLimit 以及熔斷機制做為保護，Session 的狀態也會改放到 Redis 上，這樣無論使用者進入哪一台主機都能處理以及方便擴容

後續的監控與觀測，我會結合 elk / grafana 這類專業的 log 工具去異步記錄關鍵節點，但因為這也會增加效能負擔，需要平衡思考

## Q8. 平日連線數約 20 ~ 30 的網站，觀測到了如圖中兩個不同的高峰，會如何處理故障排除？可能的故障原因有哪些？
針對圖表中的高峰觀察，我會去查詢相關 log 紀錄，確認看看那端時間是那些 api 被不斷請求，接著結合商業情境去思考看看是否合理(半夜活動，搶購，突發新聞等)，也會確認那時間附近是否有進行大型更版行為，若有會去確認該 api 的處理效能是否會太慢導致堵塞處理不來，因為時間都是在半夜附近，我可能會偏向是往系統排程問題去查詢看看，另外也會注意是否有快取緩存失效的問題

至於兩個區間的高峰行為表現我覺得也不太一樣，一個是大概六小時內兩次驟升至400~600，一個是單一高峰高點破1000，且兩者區間發生時間跨度過了 8 天，不是一個正常七天的周期，因此雖然都是凌晨 12 點後發生，但我會偏向認為是不同的情況
